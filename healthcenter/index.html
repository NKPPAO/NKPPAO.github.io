<!DOCTYPE html>
<html>
  <head>
    <title>แผนที่แสดงโรงพยาบาลส่งเสริมสุขภาพตำบลในสังกัดองค์การบริหารส่วนจังหวัดนครปฐม</title>
    <link rel="icon" type="image/x-icon" href="https://www.nkppao.go.th/customers/webpages/images/master_001.png">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <base target="_top">
  </head>
  <body>

    <iframe id="webappFrame"
      style="position: absolute;top: 0;left: 0;width: 100%;height: 100%;border: 0;"
      src="https://script.google.com/macros/s/AKfycbwTncLCuzU-lAZPUPhRRuHBhNuZTCRGquyfP7ZIqMCYo7cMRHaSREO2FvQZR7ggLvWy2g/exec" 
      sandbox="allow-scripts allow-same-origin allow-popups allow-forms allow-downloads">
    </iframe>

    <button onclick="downloadFile('pdf')">ดาวน์โหลด PDF</button>
    <button onclick="downloadFile('xlsx')">ดาวน์โหลด EXCEL</button>

    <script>
      function downloadFile(type) {
        google.script.run.withSuccessHandler(function(url) {
          // สร้างลิงก์ดาวน์โหลดไฟล์ในรูปแบบที่เบราว์เซอร์สามารถดาวน์โหลดได้
          var link = document.createElement('a');
          link.href = url;
          link.download = true; // เพิ่มคุณสมบัติ download
          document.body.appendChild(link); // เพิ่มลิงก์ไปยัง DOM
          link.click(); // คลิกเพื่อลงมือดาวน์โหลด
          document.body.removeChild(link); // ลบลิงก์หลังจากดาวน์โหลด
        }).getExportUrl(type);
      }

      window.addEventListener("message", function(event) {
        // ป้องกันถ้าไม่ใช่ message ที่เราส่งมา
        if (!event.data || event.data.type !== "export") return;

        const url = event.data.url;
        if (url) {
          var link = document.createElement('a');
          link.href = url;
          link.download = true; // บังคับให้ดาวน์โหลดไฟล์
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
        }
      });
    </script>

  </body>
</html>
